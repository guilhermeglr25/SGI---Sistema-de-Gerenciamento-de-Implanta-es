<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Migra√ß√£o de Usu√°rios - Firebase</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
      color: #e0e6ed;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      width: 100%;
      background: linear-gradient(145deg, rgba(31, 41, 55, 0.95), rgba(17, 24, 39, 0.98));
      border: 2px solid rgba(124, 58, 237, 0.5);
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      color: #7c3aed;
      font-size: 32px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .header p {
      color: #9ca3af;
      font-size: 14px;
    }

    .btn {
      padding: 15px 30px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      margin: 10px 0;
    }

    .btn-primary {
      background: linear-gradient(135deg, #7c3aed, #6d28d9);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(124, 58, 237, 0.5);
    }

    .btn-success {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.5);
    }

    .btn-warning {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
    }

    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(245, 158, 11, 0.5);
    }

    .btn-danger {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: white;
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(239, 68, 68, 0.5);
    }

    #status {
      margin-top: 30px;
      padding: 20px;
      border-radius: 12px;
      display: none;
    }

    .info-box {
      background: rgba(59, 130, 246, 0.1);
      border: 2px solid rgba(59, 130, 246, 0.3);
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
    }

    .info-box p {
      color: #93c5fd;
      line-height: 1.8;
      margin: 5px 0;
    }

    .back-link {
      text-align: center;
      margin-top: 30px;
    }

    .back-link a {
      color: #7c3aed;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s;
    }

    .back-link a:hover {
      color: #6d28d9;
      text-decoration: underline;
    }
  </style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="23 4 23 10 17 10"></polyline>
        <polyline points="1 20 1 14 7 14"></polyline>
        <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"></path>
      </svg>
      Migra√ß√£o de Usu√°rios para Firebase
    </h1>
    <p>Migre seus usu√°rios do localStorage para o Firebase em 3 passos simples</p>
  </div>

  <div class="info-box">
    <p><strong>üìã Instru√ß√µes:</strong></p>
    <p>1Ô∏è‚É£ Clique em <strong>"Verificar Usu√°rios"</strong> para ver quantos usu√°rios voc√™ tem no localStorage</p>
    <p>2Ô∏è‚É£ Clique em <strong>"Migrar para Firebase"</strong> para transferir todos os usu√°rios</p>
    <p>3Ô∏è‚É£ Clique em <strong>"Ver no Firebase"</strong> para confirmar que a migra√ß√£o foi bem-sucedida</p>
  </div>

  <!-- Adicione este novo bot√£o ANTES do bot√£o "1. Verificar Usu√°rios" -->

<div class="info-box" style="background:rgba(16,185,129,0.1);border-color:rgba(16,185,129,0.3);">
  <p style="color:#10b981;"><strong>üîß Passo Opcional:</strong></p>
  <p style="color:#6ee7b7;">Se voc√™ usa um usu√°rio espec√≠fico (como guilherme.reginato) mas ele n√£o aparece na verifica√ß√£o, adicione-o primeiro:</p>
</div>

<button class="btn btn-success" onclick="adicionarUsuarioCustomizado()">
  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
    <circle cx="8.5" cy="7" r="4"></circle>
    <line x1="20" y1="8" x2="20" y2="14"></line>
    <line x1="23" y1="11" x2="17" y2="11"></line>
  </svg>
  0. Adicionar Meu Usu√°rio (guilherme.reginato)
</button>

  <button class="btn btn-primary" onclick="verificarUsuarios()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M9 11l3 3L22 4"></path>
      <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
    </svg>
    1. Verificar Usu√°rios no localStorage
  </button>

  <button class="btn btn-success" onclick="migrarUsuarios()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"></path>
      <polyline points="17 8 12 3 7 8"></polyline>
      <line x1="12" y1="3" x2="12" y2="15"></line>
    </svg>
    2. Migrar para Firebase
  </button>

  <button class="btn btn-warning" onclick="verificarFirebase()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
      <circle cx="12" cy="12" r="3"></circle>
    </svg>
    3. Ver Usu√°rios no Firebase
  </button>

  <button class="btn btn-danger" onclick="limparLocalStorage()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <polyline points="3 6 5 6 21 6"></polyline>
      <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
    </svg>
    Limpar localStorage (ap√≥s migrar)
  </button>

  <div id="status"></div>

  <div class="back-link">
    <a href="index.html">‚Üê Voltar para o Sistema SGI</a>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
  import { getFirestore, collection, addDoc, getDocs, query, where } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

  const firebaseConfig = {
    apiKey: "AIzaSyDtFGPrvQpcmQEPfgtZCWNSbsSfnCRqnQM",
    authDomain: "sgi-sistema.firebaseapp.com",
    projectId: "sgi-sistema",
    storageBucket: "sgi-sistema.firebasestorage.app",
    messagingSenderId: "844986494867",
    appId: "1:844986494867:web:4f46410cd2e219ee3cc266",
    measurementId: "G-NXRH4592N5"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  window.db = db;
  window.firebaseFirestore = { collection, addDoc, getDocs, query, where };

  console.log('üî• Firebase conectado!');

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  // üîÑ FUN√á√ïES DE MIGRA√á√ÉO
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

  window.adicionarUsuarioCustomizado = function() {
  const statusDiv = document.getElementById('status');
  statusDiv.style.display = 'block';
  statusDiv.style.background = 'rgba(16,185,129,0.1)';
  statusDiv.style.border = '2px solid rgba(16,185,129,0.3)';
  
  try {
    // Pegar usu√°rios existentes
    let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];
    
    // Verificar se j√° existe
    const jaExiste = usuarios.find(u => u.user === 'guilherme.reginato');
    
    if (jaExiste) {
      statusDiv.innerHTML = `
        <p style="color:#f59e0b;margin:0;font-weight:600;">‚ö†Ô∏è Usu√°rio guilherme.reginato j√° existe!</p>
        <p style="color:#fbbf24;margin:10px 0 0 0;font-size:13px;">Voc√™ pode prosseguir com a migra√ß√£o normalmente.</p>
      `;
      return;
    }
    
    // Adicionar o novo usu√°rio
    usuarios.push({
      user: 'guilherme.reginato',
      pass: 'Emilly1804@@', // üîê COLOQUE SUA SENHA AQUI
      dataCriacao: new Date().toISOString()
    });
    
    // Salvar no localStorage
    localStorage.setItem('usuarios', JSON.stringify(usuarios));
    
    statusDiv.innerHTML = `
      <div style="color:#10b981;">
        <p style="margin:0;font-weight:700;font-size:18px;">‚úÖ Usu√°rio adicionado com sucesso!</p>
        <div style="background:rgba(17,24,39,0.6);border-radius:8px;padding:15px;margin:15px 0;">
          <div style="padding:12px;background:rgba(16,185,129,0.15);border-radius:8px;border-left:3px solid #10b981;">
            <strong style="color:#6ee7b7;font-size:15px;">üë§ guilherme.reginato</strong>
            <div style="color:#9ca3af;font-size:12px;margin-top:5px;">
              üìÖ Adicionado em: ${new Date().toLocaleDateString('pt-BR')}
            </div>
          </div>
        </div>
        <div style="background:rgba(59,130,246,0.1);border-left:3px solid #3b82f6;padding:15px;border-radius:8px;">
          <p style="margin:0;color:#93c5fd;font-size:14px;">
            <strong>üëâ Pr√≥ximo passo:</strong> Clique em <strong>"1. Verificar Usu√°rios"</strong> para confirmar!
          </p>
        </div>
      </div>
    `;
    
  } catch (error) {
    statusDiv.style.background = 'rgba(239,68,68,0.1)';
    statusDiv.style.border = '2px solid rgba(239,68,68,0.3)';
    statusDiv.innerHTML = `<p style="color:#ef4444;margin:0;">‚ùå Erro: ${error.message}</p>`;
  }
};

  window.verificarUsuarios = async function() {
    const statusDiv = document.getElementById('status');
    statusDiv.style.display = 'block';
    statusDiv.style.background = 'rgba(59,130,246,0.1)';
    statusDiv.style.border = '2px solid rgba(59,130,246,0.3)';
    statusDiv.innerHTML = '<p style="color:#60a5fa;margin:0;">üîç Verificando localStorage...</p>';

    try {
      const usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];

      if (usuarios.length === 0) {
        statusDiv.style.background = 'rgba(245,158,11,0.1)';
        statusDiv.style.border = '2px solid rgba(245,158,11,0.3)';
        statusDiv.innerHTML = `
          <p style="color:#f59e0b;margin:0;font-weight:600;">‚ö†Ô∏è Nenhum usu√°rio encontrado!</p>
          <p style="color:#fbbf24;margin:10px 0 0 0;font-size:13px;">O localStorage est√° vazio ou os usu√°rios j√° foram migrados.</p>
        `;
        return;
      }

      let html = `
        <div style="color:#3b82f6;">
          <p style="margin:0 0 15px 0;font-weight:700;font-size:18px;">‚úÖ ${usuarios.length} usu√°rio(s) encontrado(s)!</p>
          <div style="background:rgba(17,24,39,0.6);border-radius:8px;padding:15px;max-height:300px;overflow-y:auto;">
      `;

      usuarios.forEach((u, index) => {
        html += `
          <div style="padding:12px;margin:8px 0;background:rgba(59,130,246,0.15);border-radius:8px;border-left:3px solid #3b82f6;">
            <strong style="color:#93c5fd;font-size:15px;">${index + 1}. ${u.user}</strong>
            <div style="color:#9ca3af;font-size:12px;margin-top:5px;">
              üìÖ Criado em: ${u.dataCriacao ? new Date(u.dataCriacao).toLocaleDateString('pt-BR') : 'Data n√£o dispon√≠vel'}
            </div>
          </div>
        `;
      });

      html += `
          </div>
          <p style="margin:20px 0 0 0;color:#93c5fd;font-size:14px;background:rgba(59,130,246,0.1);padding:15px;border-radius:8px;border-left:3px solid #3b82f6;">
            üëâ <strong>Pr√≥ximo passo:</strong> Clique em <strong>"2. Migrar para Firebase"</strong> para transferir estes usu√°rios!
          </p>
        </div>
      `;

      statusDiv.innerHTML = html;

    } catch (error) {
      statusDiv.style.background = 'rgba(239,68,68,0.1)';
      statusDiv.style.border = '2px solid rgba(239,68,68,0.3)';
      statusDiv.innerHTML = `<p style="color:#ef4444;margin:0;">‚ùå Erro: ${error.message}</p>`;
    }
  };

  window.migrarUsuarios = async function() {
    const statusDiv = document.getElementById('status');
    statusDiv.style.display = 'block';
    statusDiv.style.background = 'rgba(245,158,11,0.1)';
    statusDiv.style.border = '2px solid rgba(245,158,11,0.3)';
    statusDiv.innerHTML = '<p style="color:#f59e0b;margin:0;font-weight:600;">‚è≥ Migrando... Por favor, aguarde!</p>';

    try {
      const usuarios = JSON.parse(localStorage.getItem('usuarios')) || [];

      if (usuarios.length === 0) {
        throw new Error('Nenhum usu√°rio para migrar!');
      }

      let migrados = 0;
      let jaExistentes = 0;
      let erros = 0;
      const resultados = [];

      for (const usuario of usuarios) {
        try {
          const q = query(collection(db, 'usuarios'), where('user', '==', usuario.user));
          const querySnapshot = await getDocs(q);

          if (!querySnapshot.empty) {
            jaExistentes++;
            resultados.push({
              usuario: usuario.user,
              status: 'existente',
              mensagem: 'J√° existe no Firebase'
            });
            continue;
          }

          await addDoc(collection(db, 'usuarios'), {
            user: usuario.user,
            pass: usuario.pass,
            dataCriacao: usuario.dataCriacao || new Date().toISOString()
          });

          migrados++;
          resultados.push({
            usuario: usuario.user,
            status: 'sucesso',
            mensagem: 'Migrado com sucesso!'
          });

        } catch (error) {
          erros++;
          resultados.push({
            usuario: usuario.user,
            status: 'erro',
            mensagem: error.message
          });
        }
      }

      let html = `
        <div>
          <h3 style="color:#10b981;margin:0 0 20px 0;font-size:22px;">üéâ Migra√ß√£o Conclu√≠da!</h3>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:20px;">
            <div style="background:rgba(16,185,129,0.2);padding:20px;border-radius:12px;text-align:center;border:2px solid rgba(16,185,129,0.4);">
              <div style="font-size:36px;font-weight:800;color:#10b981;">${migrados}</div>
              <div style="font-size:12px;color:#6ee7b7;margin-top:5px;font-weight:600;">MIGRADOS</div>
            </div>
            <div style="background:rgba(245,158,11,0.2);padding:20px;border-radius:12px;text-align:center;border:2px solid rgba(245,158,11,0.4);">
              <div style="font-size:36px;font-weight:800;color:#f59e0b;">${jaExistentes}</div>
              <div style="font-size:12px;color:#fbbf24;margin-top:5px;font-weight:600;">J√Å EXISTIAM</div>
            </div>
            <div style="background:rgba(239,68,68,0.2);padding:20px;border-radius:12px;text-align:center;border:2px solid rgba(239,68,68,0.4);">
              <div style="font-size:36px;font-weight:800;color:#ef4444;">${erros}</div>
              <div style="font-size:12px;color:#fca5a5;margin-top:5px;font-weight:600;">ERROS</div>
            </div>
          </div>

          <div style="background:rgba(17,24,39,0.6);border-radius:12px;padding:20px;max-height:300px;overflow-y:auto;">
      `;

      resultados.forEach(r => {
        const cor = r.status === 'sucesso' ? '#10b981' : (r.status === 'existente' ? '#f59e0b' : '#ef4444');
        const icone = r.status === 'sucesso' ? '‚úÖ' : (r.status === 'existente' ? '‚ö†Ô∏è' : '‚ùå');

        html += `
          <div style="padding:12px;margin:8px 0;background:rgba(31,41,55,0.9);border-left:3px solid ${cor};border-radius:8px;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <strong style="color:#e5e7eb;font-size:14px;">${icone} ${r.usuario}</strong>
              <span style="color:${cor};font-size:12px;background:${cor}22;padding:4px 10px;border-radius:6px;font-weight:600;">${r.mensagem}</span>
            </div>
          </div>
        `;
      });

      html += `
          </div>
          <div style="margin-top:20px;background:rgba(16,185,129,0.1);border-left:3px solid #10b981;padding:15px;border-radius:8px;">
            <p style="margin:0;color:#34d399;font-size:14px;">
              <strong>‚úÖ Pr√≥ximo passo:</strong> Clique em <strong>"3. Ver Usu√°rios no Firebase"</strong> para confirmar!
            </p>
          </div>
        </div>
      `;

      statusDiv.style.background = 'rgba(16,185,129,0.1)';
      statusDiv.style.border = '2px solid rgba(16,185,129,0.3)';
      statusDiv.innerHTML = html;

    } catch (error) {
      statusDiv.style.background = 'rgba(239,68,68,0.1)';
      statusDiv.style.border = '2px solid rgba(239,68,68,0.3)';
      statusDiv.innerHTML = `
        <p style="color:#ef4444;margin:0;font-weight:600;">‚ùå Erro na migra√ß√£o!</p>
        <p style="color:#fca5a5;margin:10px 0 0 0;font-size:13px;">${error.message}</p>
      `;
    }
  };

  window.verificarFirebase = async function() {
    const statusDiv = document.getElementById('status');
    statusDiv.style.display = 'block';
    statusDiv.style.background = 'rgba(124,58,237,0.1)';
    statusDiv.style.border = '2px solid rgba(124,58,237,0.3)';
    statusDiv.innerHTML = '<p style="color:#7c3aed;margin:0;">üîç Consultando Firebase...</p>';

    try {
      const querySnapshot = await getDocs(collection(db, 'usuarios'));

      if (querySnapshot.empty) {
        statusDiv.style.background = 'rgba(245,158,11,0.1)';
        statusDiv.style.border = '2px solid rgba(245,158,11,0.3)';
        statusDiv.innerHTML = `
          <p style="color:#f59e0b;margin:0;font-weight:600;">‚ö†Ô∏è Nenhum usu√°rio no Firebase!</p>
          <p style="color:#fbbf24;margin:10px 0 0 0;font-size:13px;">Execute a migra√ß√£o primeiro.</p>
        `;
        return;
      }

      let html = `
        <div style="color:#7c3aed;">
          <p style="margin:0 0 15px 0;font-weight:700;font-size:18px;">‚òÅÔ∏è ${querySnapshot.size} usu√°rio(s) no Firebase!</p>
          <div style="background:rgba(17,24,39,0.6);border-radius:8px;padding:15px;max-height:300px;overflow-y:auto;">
      `;

      let index = 1;
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        html += `
          <div style="padding:12px;margin:8px 0;background:rgba(124,58,237,0.15);border-radius:8px;border-left:3px solid #7c3aed;">
            <strong style="color:#c4b5fd;font-size:15px;">${index}. ${data.user}</strong>
            <div style="color:#9ca3af;font-size:12px;margin-top:5px;">
              üÜî ID: ${doc.id}<br>
              üìÖ Criado: ${data.dataCriacao ? new Date(data.dataCriacao).toLocaleDateString('pt-BR') : 'N/A'}
            </div>
          </div>
        `;
        index++;
      });

      html += `
          </div>
          <div style="margin-top:20px;background:rgba(16,185,129,0.1);border-left:3px solid #10b981;padding:15px;border-radius:8px;">
            <p style="margin:0;color:#34d399;font-size:14px;">
              <strong>‚úÖ Sucesso!</strong> Todos os usu√°rios est√£o sincronizados no Firebase!<br>
              Agora voc√™ pode limpar o localStorage com seguran√ßa.
            </p>
          </div>
        </div>
      `;

      statusDiv.innerHTML = html;

    } catch (error) {
      statusDiv.style.background = 'rgba(239,68,68,0.1)';
      statusDiv.style.border = '2px solid rgba(239,68,68,0.3)';
      statusDiv.innerHTML = `<p style="color:#ef4444;margin:0;">‚ùå Erro: ${error.message}</p>`;
    }
  };

  window.limparLocalStorage = function() {
    if (!confirm('‚ö†Ô∏è TEM CERTEZA?\n\nIsso ir√° APAGAR todos os usu√°rios do localStorage.\n\nCertifique-se de que a migra√ß√£o foi bem-sucedida antes de continuar!')) {
      return;
    }

    try {
      localStorage.removeItem('usuarios');

      const statusDiv = document.getElementById('status');
      statusDiv.style.display = 'block';
      statusDiv.style.background = 'rgba(16,185,129,0.1)';
      statusDiv.style.border = '2px solid rgba(16,185,129,0.3)';
      statusDiv.innerHTML = `
        <p style="color:#10b981;margin:0;font-weight:600;">‚úÖ localStorage limpo com sucesso!</p>
        <p style="color:#34d399;margin:10px 0 0 0;font-size:13px;">
          Agora todos os usu√°rios s√≥ existem no Firebase. Voc√™ pode voltar ao sistema principal.
        </p>
      `;

    } catch (error) {
      alert('Erro ao limpar: ' + error.message);
    }
  };
</script>

</body>
</html>